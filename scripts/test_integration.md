# 前后端联调测试指南

## 📋 测试清单

### 准备工作

- [ ] Go 环境已安装 (go version)
- [ ] Node.js 已安装 (node --version)
- [ ] npm 已安装 (npm --version)
- [ ] 已有 OpenAI API Key
- [ ] 已有 API Base URL

### 后端测试

- [ ] Go 项目编译成功
- [ ] 后端服务器启动成功
- [ ] API 端点响应正常
- [ ] WebSocket 连接正常

### 前端测试

- [ ] npm 依赖安装成功
- [ ] React 开发服务器启动成功
- [ ] 前端页面加载正常
- [ ] API 代理配置正常

### 功能测试

- [ ] Agent 类型列表加载
- [ ] 工具列表加载
- [ ] ReAct Agent 对话
- [ ] Chain Agent 对话
- [ ] Plan Agent 对话
- [ ] 流式响应功能
- [ ] 非流式响应功能
- [ ] 会话管理
- [ ] 错误处理

## 🚀 启动步骤

### 步骤1: 启动后端服务器

打开第一个终端窗口：

```bash
# 切换到项目目录
cd D:\workspace\github\jas-agent

# 启动服务器
cd cmd\server
go run main.go -apiKey YOUR_API_KEY -baseUrl YOUR_BASE_URL
```

**预期输出**:
```
🚀 启动 JAS Agent 服务器...
✅ gRPC服务已创建
🌐 HTTP服务器启动在 :8080
📡 API端点: http://localhost:8080/api
🌍 前端界面: http://localhost:8080
```

**检查项**:
- ✅ 无编译错误
- ✅ 服务器成功监听 8080 端口
- ✅ 日志输出正常

### 步骤2: 测试 API 端点

打开第二个终端窗口，测试 API：

```bash
# 测试获取 Agent 列表
curl http://localhost:8080/api/agents

# 预期返回 JSON 数据
```

**预期输出**:
```json
{
  "agents": [
    {
      "type": "react",
      "name": "ReAct Agent",
      "description": "通用推理代理，支持思考-行动-观察循环",
      "available": true
    },
    ...
  ]
}
```

```bash
# 测试获取工具列表
curl http://localhost:8080/api/tools

# 预期返回工具列表
```

**预期输出**:
```json
{
  "tools": [
    {
      "name": "calculator",
      "description": "数学表达式计算器",
      "type": "Normal"
    },
    ...
  ]
}
```

### 步骤3: 启动 React 前端

打开第三个终端窗口：

```bash
# 切换到 web 目录
cd D:\workspace\github\jas-agent\web

# 安装依赖（首次运行）
npm install

# 启动开发服务器
npm run dev
```

**预期输出**:
```
VITE v5.0.0  ready in xxx ms

➜  Local:   http://localhost:3000/
➜  Network: use --host to expose
➜  press h + enter to show help
```

**检查项**:
- ✅ npm install 成功
- ✅ Vite 启动成功
- ✅ 无编译错误
- ✅ 3000 端口监听成功

### 步骤4: 测试前端页面

在浏览器中打开: http://localhost:3000

#### 4.1 页面加载测试

**检查项**:
- [ ] 页面正常加载，无白屏
- [ ] 标题显示: "🤖 JAS Agent 对话系统"
- [ ] 配置面板显示正常
- [ ] 欢迎消息显示
- [ ] 示例问题按钮显示

#### 4.2 配置面板测试

**检查项**:
- [ ] Agent 类型下拉框有选项（ReAct、Chain、Plan）
- [ ] 模型下拉框有选项（GPT-3.5、GPT-4）
- [ ] 最大步数输入框可编辑
- [ ] 系统提示词文本框可编辑
- [ ] 流式响应复选框可切换
- [ ] "清空对话"按钮可点击
- [ ] "查看工具"按钮可点击

#### 4.3 工具列表测试

**操作步骤**:
1. 点击"查看工具"按钮
2. 模态框弹出
3. 查看工具列表

**检查项**:
- [ ] 模态框正常弹出
- [ ] 显示工具列表（calculator、averageDogWeight 等）
- [ ] 每个工具显示名称、类型、描述
- [ ] 点击关闭按钮可关闭
- [ ] 点击外部区域可关闭

### 步骤5: 功能测试

#### 5.1 测试 ReAct Agent（非流式）

**操作步骤**:
1. 选择 Agent 类型: "ReAct"
2. 取消勾选"启用流式响应"
3. 在输入框输入: "计算 15 + 27"
4. 点击发送

**检查项**:
- [ ] 用户消息显示在对话区
- [ ] 发送按钮变为"处理中"状态
- [ ] 状态栏显示"处理中"
- [ ] 等待片刻后收到响应
- [ ] 助手消息显示在对话区
- [ ] 消息包含计算结果（42）
- [ ] 状态栏显示完成信息
- [ ] 显示元数据（步骤数、工具、执行时间）

#### 5.2 测试 ReAct Agent（流式）

**操作步骤**:
1. 选择 Agent 类型: "ReAct"
2. 勾选"启用流式响应"
3. 在输入框输入: "我有一只边境牧羊犬，它的平均体重是多少？"
4. 点击发送

**检查项**:
- [ ] WebSocket 连接建立（检查浏览器 Network 标签）
- [ ] 实时显示思考过程（💭 图标）
- [ ] 实时显示动作（⚙️ 图标）
- [ ] 实时显示观察结果（👁️ 图标）
- [ ] 最后显示完整答案
- [ ] 状态栏实时更新步骤数
- [ ] 最终显示完成状态和元数据

#### 5.3 测试 Plan Agent

**操作步骤**:
1. 选择 Agent 类型: "Plan"
2. 启用流式响应
3. 输入: "我有3只狗，分别是border collie、scottish terrier和toy poodle，计算总体重"
4. 点击发送

**检查项**:
- [ ] 显示计划生成过程
- [ ] 显示步骤执行过程
- [ ] 每个步骤的结果都显示
- [ ] 最终显示总结
- [ ] 元数据包含所有使用的工具

#### 5.4 测试 Chain Agent

**操作步骤**:
1. 选择 Agent 类型: "Chain"
2. 输入任意查询
3. 点击发送

**检查项**:
- [ ] Chain 节点执行显示
- [ ] 链式流程正常
- [ ] 返回最终结果

### 步骤6: 浏览器开发者工具检查

打开浏览器开发者工具 (F12):

#### Console 标签
**检查项**:
- [ ] 无 JavaScript 错误
- [ ] 无警告信息（或只有预期的警告）
- [ ] WebSocket 连接日志正常

#### Network 标签
**检查项**:
- [ ] API 请求成功（Status 200）
- [ ] WebSocket 连接建立（Status 101）
- [ ] 请求/响应数据格式正确

#### Application 标签
**检查项**:
- [ ] 无 Console 错误
- [ ] WebSocket 连接活跃

## 🧪 测试用例

### 测试用例 1: 简单计算

```
输入: 计算 (15 + 27) * 3
预期: 返回结果 126
验证: 元数据显示使用了 calculator 工具
```

### 测试用例 2: 狗狗体重查询

```
输入: 我有一只边境牧羊犬和一只苏格兰梗，它们的总体重是多少？
预期: 
  1. 查询两种狗的体重
  2. 计算总和
  3. 返回总体重（约 57 磅）
验证: 使用了 averageDogWeight 和 calculator 工具
```

### 测试用例 3: 复杂多步骤任务（Plan）

```
输入: 我有3只狗，分别是border collie、scottish terrier和toy poodle，请查询它们的平均体重然后计算总重量
预期:
  1. 生成执行计划（4个步骤）
  2. 查询3种狗的体重
  3. 计算总和
  4. 返回结果（约 64 磅）
验证: 显示完整的执行计划和步骤
```

### 测试用例 4: 流式响应

```
配置: 启用流式响应
输入: 任意查询
预期:
  1. 实时显示思考过程
  2. 实时显示动作执行
  3. 实时显示观察结果
  4. 最后显示最终答案
验证: 消息逐步出现，不是一次性显示
```

## 📊 性能测试

### 响应时间

| 测试项 | 预期时间 |
|--------|---------|
| Agent 列表加载 | < 100ms |
| 工具列表加载 | < 100ms |
| 简单计算（ReAct） | 1-3秒 |
| 复杂查询（Plan） | 5-10秒 |
| WebSocket 连接 | < 100ms |

### 并发测试

1. 打开多个浏览器标签
2. 同时发起请求
3. 验证各个会话独立工作

## ❌ 常见问题排查

### 问题1: 后端启动失败

**症状**: `fatal error: ...`

**检查**:
```bash
# 检查编译
go build ./...

# 检查端口占用
netstat -ano | findstr :8080
```

**解决**:
- 确保提供了正确的 API Key 和 Base URL
- 确保 8080 端口未被占用
- 查看完整错误信息

### 问题2: 前端启动失败

**症状**: `npm run dev` 报错

**检查**:
```bash
# 重新安装依赖
rm -rf node_modules package-lock.json
npm install
```

**解决**:
- 确保 Node.js 版本 >= 16
- 确保网络连接正常
- 检查 package.json 格式

### 问题3: API 请求失败

**症状**: 浏览器控制台显示 404 或 CORS 错误

**检查**:
1. 后端是否正常运行
2. Vite 代理配置是否正确
3. 浏览器 Network 标签查看请求详情

**解决**:
```javascript
// 检查 vite.config.js
proxy: {
  '/api': {
    target: 'http://localhost:8080',
    changeOrigin: true,
  },
}
```

### 问题4: WebSocket 连接失败

**症状**: 流式响应不工作

**检查**:
1. 浏览器控制台是否有 WebSocket 错误
2. Network 标签是否显示 WebSocket 连接（WS）
3. 后端是否支持 WebSocket

**解决**:
- 确保后端 WebSocket 处理函数正常
- 检查防火墙设置
- 尝试使用非流式模式

## 🎯 验收标准

### 基本功能 ✅

- [x] 编译通过
- [ ] 后端启动成功
- [ ] 前端启动成功
- [ ] 页面正常显示
- [ ] API 调用成功
- [ ] WebSocket 连接成功

### 核心功能 ✅

- [ ] ReAct Agent 正常工作
- [ ] Plan Agent 正常工作
- [ ] Chain Agent 正常工作
- [ ] 流式响应正常
- [ ] 非流式响应正常
- [ ] 工具列表显示正常

### 用户体验 ✅

- [ ] UI 美观，无错位
- [ ] 响应流畅，无卡顿
- [ ] 错误提示清晰
- [ ] 加载状态明确
- [ ] 操作符合预期

## 📝 测试记录模板

```
测试时间: ___________
测试人员: ___________
环境配置: ___________

【后端测试】
□ 编译成功: ___________
□ 启动成功: ___________
□ API响应: ___________

【前端测试】
□ 安装成功: ___________
□ 启动成功: ___________
□ 页面加载: ___________

【功能测试】
□ ReAct Agent: ___________
□ Plan Agent: ___________
□ Chain Agent: ___________
□ 流式响应: ___________

【问题记录】
1. ___________
2. ___________
3. ___________

【总体评价】
___________
```

## 🔍 调试技巧

### 1. 查看后端日志

后端会输出执行日志：
```
Thought: ...
Action: calculator[15 + 27]
Observation: 42
```

### 2. 查看浏览器控制台

前端会输出调试信息：
```javascript
WebSocket connected
收到消息: {type: "thinking", content: "..."}
```

### 3. 使用 Network 标签

- 查看 API 请求详情
- 查看 WebSocket 消息
- 检查请求/响应数据

### 4. 使用 React DevTools

安装 React DevTools 浏览器扩展，可以：
- 查看组件树
- 检查 Props 和 State
- 查看性能

## 🎬 开始测试！

现在您可以按照上述步骤进行测试。如果遇到任何问题，请参考"常见问题排查"部分。

祝测试顺利！🎉

